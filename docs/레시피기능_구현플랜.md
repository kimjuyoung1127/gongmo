# 🍳 AI 레시피 기능 구현 플랜

## 개요
보유 재료 기반의 AI 레시피 추천 기능을 구현하기 위한 체크리스트입니다. 토스 스타일 UI와 하이브리드 API 전략을 사용합니다.

---

## 📋 백엔드 구현

### 🗄️ 데이터베이스 스키마 추가
- [ ] 레시피 캐시 테이블 생성 (`recipes`)
  - `id`, `menu_name`, `recipe_data`, `created_at`, `updated_at`
  - 인덱스 설정: `menu_name` (UNIQUE)
  - RLS 정책: 전체 읽기 가능, 인증된 사용자만 쓰기 가능

### 🔗 API 엔드포인트 구현
- [ ] **backend/api/routes/recipe.py** 생성
  - [ ] `GET /recipe/search` - 재료 기반 레시피 검색
  - [ ] `GET /recipe/detail/<menu_name>` - 레시피 상세 정보
  - [ ] `POST /recipe/complete` - 요리 완료 및 재고 차감

### 🤖 AI 통합 서비스
- [ ] **backend/api/services/recipe_service.py** 생성
  - [ ] `get_recipe_detail(menu_name)` 함수 구현
    - DB 캐시 확인 → 외부 API 호출 → Gemini 변환 → DB 저장 → 반환
  - [ ] `search_recipes_by_ingredients(ingredients)` 함수 구현
    - 사용자 재료와 매칭률 계산
  - [ ] Gemini 프롬프트 작성
    - 식약처 데이터 → `{시간, 난이도, 재료, 꿀팁}` JSON 변환

### 🌐 외부 API 연동
- [ ] **backend/api/utils/food_api.py** 생성
  - [ ] 식품안전나라 API 연동 (조리식품 레시피)
  - [ ] TheMealDB API 연동 (양식 레시피 보완)
  - [ ] API 키 환경변수 설정

### 🔄 서버 설정 업데이트
- [ ] **backend/api/app.py** 수정
  - [ ] recipe 블루프린트 등록
  - [ ] 외부 API 키 로드
  - [ ] Gemini API 클라이언트 설정

---

## 📱 프론트엔드 구현

### 🎨 UI 컴포넌트 생성
- [ ] **app/components/RecipeCard.tsx** - 레시피 리스트 카드
  - [ 썸네일 이미지
  - [ ] 레시피 이름
  - [ ] 재료 매칭률 (토스 블루 색상)
  - [ ] 부족한 재료 목록

- [ ] **app/components/RecipeDetailModal.tsx** - 레시피 상세 모달
  - [ ] 스크린을 꽉 채우는 바텀시트 형태
  - [ ] 스켈레톤 로딩 UI
  - [ ] 요약 카드 (`⏱️ 20분` | `⭐️ 난이도` | `🔥 480kcal`)
  - [ ] 재료 체크리스트 (보유 ✅, 부족 ❌)
  - [ ] 조리 순서 (스텝별)
  - [ ] AI 꿀팁 섹션
  - [ ] 하단 고정 버튼 `[ 요리 완료! ]`

- [ ] **app/components/RecipeRecommendationList.tsx** - 추천 레시피 리스트
  - [ ] 수평 스크롤 카드 형태
  - [ ] 빈 상태 UI (재료 없을 때)

### 🔧 로직 훅 생성
- [ ] **app/hooks/useRecipe.ts** 생성
  - [ ] `useRecipes()` - 추천 레시피 조회
  - [ ] `useRecipeDetail(menuName)` - 레시피 상세 조회
  - [ ] `completeRecipe()` - 요리 완료 처리
  - [ ] 캐싱 로직 (React Query)

### 📄 화면 수정
- [ ] **app/app/(tabs)/recipe.tsx** 전체 재작성
  - [ ] 인증 상태 확인 (기존 코드 활용)
  - [ ] 레시피 추천 리스트 노출
  - [ ] RecipeCard 클릭 시 RecipeDetailModal 열기
  - [ ] 빈 상태 처리 (재고 없을 때)
  - [ ] 로딩 상태 및 에러 상태 처리

### 🌐 API 통합
- [ ] **app/lib/api/recipe.ts** 생성
  - [ ] `fetchRecommendRecipes(userId)` 함수
  - [ ] `fetchRecipeDetail(menuName)` 함수
  - [ ] `postCompleteRecipe(recipeId, inventoryUpdates)` 함수

---

## 🔄 데이터 흐름 연동

### 📊 재고-레시피 매칭 로직
- [ ] 사용자의 활성 재고 조회 (기존 `loadActiveInventory` 활용)
- [ ] 재료명 표준화 로직 (김치 → 배추김치, 계란→달걀 등)
- [ ] 매칭 알고리즘 구현
  - [ ] 재료 보유율 계산
  - [ ] 우선순위 정렬 (보유율 높은 순 + 만료 임박)

### 📈 재고 차감 기능
- [ ] 레시피 완료 시 재고 재료 자동 차감
- [ ] 수량 처리 (재료가 여러 개일 때 부분 차감 옵션)
- [ ] 재고 상태 업데이트 (`active` → `consumed`)

---

## 🎯 기능 테스트

### ✅ 단위 테스트
- [ ] 외부 API 연동 테스트
- [ ] Gemini 변환 로직 테스트
- [ ] 재료 매칭 알고리즘 테스트
- [ ] UI 컴포넌트 스냅샷 테스트

### 🔍 통합 테스트
- [ ] 레시피 검색 → 상제 보기 → 완료 흐름 테스트
- [ ] 로그인/비로그인 상태 테스트
- [ ] 네트워크 오류 상황 테스트
- [ ] 성능 테스트 (캐시 히트/미스)

---

## 🚀 배포 및 옵티마이제이션

### ⚡ 성능 최적화
- [ ] 레시피 이미지 레이지 로딩
- [ ] API 응답 캐싱 (React Query)
- [ ] 무한 스크롤 구현 (레시피 리스트)
- [ ] 이미지 최적화 (썸네일)

### 📊 모니터링
- [ ] API 호출 모니터링
- [ ] 캐시 히트율 추적
- [ ] 사용자 행동 분석 (클릭률, 완료율)

### 🔧 사전 워밍업
- [ ] 인기 레시피 50개 사전 변환 스크립트
- [ ] 배치 작업 스케줄링 (주기적 캐시 워밍)

---

## 📱 라우팅 업데이트

### 🔄 기존 파일 수정
- [ ] **app/app/(tabs)/_layout.tsx**
  - [ ] recipe 탭 클릭 시 데모 모드 처리 (기존 로직 유지)
  - [ ] 로그인된 사용자는 바로 recipe 화면 이동

### 🧪 데모 데이터 연동
- [ ] **app/hooks/useDemoData.ts** 수정
  - [ ] 데모용 레시피 데이터 추가
  - [ ] 재고 기반 추천 로직 시뮬레이션

---

## 📝 문서 및 배포

### 📖 사용자 문서
- [ ] 레시피 기능 사용 가이드
- [ ] FAQ 및 문제해결

### 🛠️ 개발 문서
- [ ] API 명세서 업데이트
- [ ] 컴포넌트 Storybook (선택)
- [ ] 배포 체크리스트

---

## 🎯 MVP 최소 기능 범위

### ✅ Phase 1 (기본 기능)
- [ ] 재료 기반 레시피 추천 (최대 5개)
- [ ] 레시피 상세 보기
- [ ] 기본적인 요리 완료 기능

### 🔄 Phase 2 (향상 기능)
- [ ] AI 꿀팁 및 영양 정보
- [ ] 재료 매칭률 시각화
- [ ] 만료 임박 재료 우선 추천

### 🚀 Phase 3 (고급 기능)
- [ ] 개인화 추천 알고리즘
- [ ] 레시피 평가 및 즐겨찾기
- [ ] SNS 공유 기능

---

## 🔧 필요한 환경변수 추가

### 📱 프론트엔드 (.env)
```
# 기존 변수 유지
EXPO_PUBLIC_SUPABASE_URL=...
EXPO_PUBLIC_SUPABASE_ANON_KEY=...
```

### 🖥️ 백엔드 (.env)
```
# 기존 변수 유지
SUPABASE_URL=...
SUPABASE_ANON_KEY=...
# 신규 추가
FOOD_SAFETY_API_KEY=...
GEMINI_API_KEY=...
```

---

## 🎯 성공 지표

### 📈 기술적 지표
- [ ] 레시피 로딩 시간 < 2초 (캐시 히트 시 < 0.5초)
- [ ] API 비용 < $10/월 (스마트 캐싱으로)
- [ ] 레시피 카드 렌더링 < 100ms

### 👥 사용자 지표
- [ ] 레시피 기능 사용률 > 30%
- [ ] 요리 완료 전환율 > 15%
- [ ] 재료 매칭 만족도 > 4.0/5.0

---

*이 플랜은 2025-11-17 현재 프로젝트 구조를 기반으로 작성되었습니다.*
