# 🍳 AI 레시피 기능 구현 플랜 - 실행 계획

## 개요
보유 재료 기반의 AI 레시피 추천 기능을 구현하기 위한 실행 가능한 개발 계획입니다. 토스 스타일 UI와 하이브리드 API 전략을 사용하며, 현재 프로젝트 구조에 맞춘 실현 가능한 단계별 실행 계획입니다.

---

## 📋 현재 상태 분석

### 프론트엔드 상태
- `app/app/(tabs)/recipe.tsx`: "Coming Soon" 화면만 존재 (실제 기능 없음)
- `app/app/(tabs)/_layout.tsx`: 레시피 탭 네비게이션은 이미 설정됨
- 레시피 관련 UI 컴포넌트: **전부 없음**
- 레시피 관련 훅 및 API 파일: **전부 없음**

### 백엔드 상태  
- 레시피 관련 API 라우트/서비스: **전부 없음**
- 현재 블루프린트: `ocr`, `barcode`, `inventory`, `health`
- 레시피 테이블: **DB에 없음**
- 외부 API 연동: **전부 없음**

---

## 🚀 Phase 1: 백엔드 핵심 인프라 구현 (MVP Core)

### 1.1 데이터베이스 스키마 생성
- [ ] `recipes` 테이블 생성 (`id`, `menu_name`, `recipe_data`, `created_at`, `updated_at`)
  - [ ] `menu_name` 유니크 인덱스
  - [ ] RLS 정책 설정: 전체 읽기 가능, 인증된 사용자만 쓰기 가능
  - [ ] `handle_updated_at` 트리거 연결

### 1.2 API 라우트 구현
- [ ] `backend/api/routes/recipe.py` 생성
  - [ ] `GET /recipe/search` - 사용자의 재료 기반 레시피 검색
  - [ ] `GET /recipe/detail/<menu_name>` - 레시피 상세 정보
  - [ ] `POST /recipe/complete` - 요리 완료 및 재고 차감

### 1.3 레시피 서비스 로직
- [ ] `backend/api/services/recipe_service.py` 생성
  - [ ] `get_recipe_detail(menu_name)` - 레시피 상세 가져오기 (DB 캐시 → 외부 API 호출 → 저장)
  - [ ] `search_recipes_by_ingredients(ingredients)` - 재료 기반 레시피 검색
  - [ ] 매칭 알고리즘 구현 (재료 보유율 계산)

### 1.4 외부 API 연동
- [ ] `backend/api/utils/food_api.py` 생성
  - [ ] 식품안전나라 API 연동 (한식 레시피)
  - [ ] TheMealDB API 연동 (양식 레시피)
  - [ ] API 키 환경변수 설정

### 1.5 서버 설정 업데이트
- [ ] `backend/api/app.py` 수정
  - [ ] recipe 블루프린트 등록
  - [ ] 필요한 의존성 import

---

## 📱 Phase 2: 프론트엔드 UI 컴포넌트 구현

### 2.1 핵심 UI 컴포넌트
- [ ] `app/components/RecipeCard.tsx` 생성
  - [ ] 레시피 썸네일 이미지
  - [ ] 레시피 이름
  - [ ] 재료 매칭률 (토스 블루 색상)
  - [ ] 부족한 재료 목록

- [ ] `app/components/RecipeDetailModal.tsx` 생성
  - [ ] 스크린을 꽉 채우는 바텀시트 형태
  - [ ] 스켈레톤 로딩 UI
  - [ ] 요약 카드 (`⏱️ 20분` | `⭐️ 난이도` | `🔥 480kcal`)
  - [ ] 재료 체크리스트 (보유 ✅, 부족 ❌)
  - [ ] 조리 순서 (스텝별)
  - [ ] AI 꿀팁 섹션
  - [ ] 하단 고정 버튼 `[ 요리 완료! ]`

- [ ] `app/components/RecipeRecommendationList.tsx` 생성
  - [ ] 수평 스크롤 카드 형태
  - [ ] 빈 상태 UI (재료 없을 때)

### 2.2 훅 및 로직
- [ ] `app/hooks/useRecipe.ts` 생성
  - [ ] `useRecipes()` - 추천 레시피 조회
  - [ ] `useRecipeDetail(menuName)` - 레시피 상세 조회
  - [ ] `completeRecipe()` - 요리 완료 처리
  - [ ] React Query 캐싱 로직

### 2.3 API 연동 라이브러리
- [ ] `app/lib/api/recipe.ts` 생성
  - [ ] `fetchRecommendRecipes(userId)` 함수
  - [ ] `fetchRecipeDetail(menuName)` 함수
  - [ ] `postCompleteRecipe(recipeId, inventoryUpdates)` 함수

---

## 🔄 Phase 3: 현재 레시피 화면 리팩토링

### 3.1 레시피 화면 업데이트
- [ ] `app/app/(tabs)/recipe.tsx` 리팩토링
  - [ ] "Coming Soon" 화면 제거
  - [ ] 현재 로그인 상태 확인 로직 유지
  - [ ] 레시피 추천 리스트 표시
  - [ ] RecipeCard 클릭 시 RecipeDetailModal 열기
  - [ ] 빈 상태 처리 (재고 없을 때)
  - [ ] 로딩 상태 및 에러 상태 처리

---

## 🔄 Phase 4: 데이터 흐름 통합

### 4.1 재고-레시피 매칭 로직
- [ ] 사용자의 활성 재고 조회 (`inventory` 테이블에서 `status = 'active'`인 항목)
- [ ] 재료명 표준화 로직 구현
- [ ] 매칭 알고리즘 구현
  - [ ] 재료 보유율 계산
  - [ ] 우선순위 정렬 (보유율 높은 순 + 만료 임박)

### 4.2 재고 차감 기능
- [ ] 레시피 완료 시 재고 재료 자동 차감
- [ ] 수량 처리 (재료가 여러 개일 때 부분 차감)
- [ ] 재고 상태 업데이트 (`active` → `consumed`)

---

## ✅ Phase 5: 테스트 및 검증

### 5.1 단위 테스트
- [ ] 외부 API 연동 테스트
- [ ] 재료 매칭 알고리즘 테스트
- [ ] UI 컴포넌트 스냅샷 테스트

### 5.2 통합 테스트
- [ ] 레시피 검색 → 상세 보기 → 완료 흐름 테스트
- [ ] 로그인/비로그인 상태 테스트
- [ ] 네트워크 오류 상황 테스트

---

## 🚀 Phase 6: 배포 및 최적화

### 6.1 성능 최적화
- [ ] 레시피 이미지 레이지 로딩
- [ ] API 응답 캐싱 (React Query)
- [ ] 무한 스크롤 구현 (레시피 리스트)

### 6.2 모니터링
- [ ] API 호출 모니터링
- [ ] 캐시 히트율 추적
- [ ] 사용자 행동 분석

### 6.3 사전 워밍업
- [ ] 인기 레시피 50개 사전 변환 스크립트
- [ ] 배치 작업 스케줄링 (주기적 캐시 워밍)

---

## 📊 기능 흐름도

### 로그인 사용자
```
레시피 탭 클릭 → 활성 재고 조회 → 레시피 매칭 → 추천 리스트 표시 → RecipeCard 클릭 → RecipeDetailModal 표시 → 요리 완료 클릭 → 재고 차감
```

### 비로그인 사용자 (데모 모드)
```
레시피 탭 클릭 → 로그인 모달 표시 → 로그인 or 취소 선택
```

---

## 📈 성공 지표

### 기술적 지표
- [ ] 레시피 로딩 시간 < 2초 (캐시 히트 시 < 0.5초)
- [ ] API 비용 < $10/월 (스마트 캐싱으로)
- [ ] 레시피 카드 렌더링 < 100ms

### 사용자 지표
- [ ] 레시피 기능 사용률 > 30%
- [ ] 요리 완료 전환율 > 15%
- [ ] 재료 매칭 만족도 > 4.0/5.0

---

## 🔧 필요한 환경변수

### 백엔드 (.env)
```
# 기존 변수 유지
SUPABASE_URL=...
SUPABASE_ANON_KEY=...
# 신규 추가
FOOD_SAFETY_API_KEY=...
THEMEALDB_API_KEY=...
```

---

## 🎯 MVP 최소 범위

### Phase 1-3 완료 시 제공 기능
- [x] 재료 기반 레시피 추천 (최대 5개)
- [x] 레시피 상세 보기
- [x] 기본적인 요리 완료 기능
- [x] 재고 차감 기능

### Phase 4-5 완료 시 제공 기능
- [ ] AI 꿀팁 및 영양 정보
- [ ] 재료 매칭률 시각화
- [ ] 만료 임박 재료 우선 추천

---

*이 실행 계획은 2025-11-18에 업데이트되었습니다.*