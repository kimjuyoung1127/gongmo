# 프로젝트 진행 상황 및 다음 계획 (2025-11-15)

지금까지의 진행 상황을 정리하고, 다음 우선순위 계획을 제시합니다.

---

## 🎯 현재 진행 상황 (2025-11-15)

### ✅ 완료된 기능
**바코드 캐싱 시스템**
- DB 캐싱 구조 (products → inventory 2단계 저장)
- 직접 입력 기능 (404 오류 시)
- API 호출 최적화 (DB HIT 시 0.1초 응답)

**기술 개선**
- scan.tsx 모듈화 시작 (components/scan/ 생성)
- 백엔드 API 완료 (/upload_receipt 추가)
- ML 모델 경로 수정 (models/item_classifier.pkl)

---

## 🚀 다음 우선순위 계획

### **Phase 1: 영수증 OCR 2단계 구현 (우선순위: 높음)**
```
1. 영수증 결과 검토 화면 (receipt-review.tsx)
   ├─ AI 분석 결과 FlatList 표시
   ├─ 체크박스 기본 기능 구현
   └─ [선택 항목 추가] 버튼

2. 카테고리 수정 기능
   ├─ 카테고리 태그 탭 → 바텀시트 모달
   ├─ categories 테이블 연동
   └─ 최근 사용 카테고리 상단 고정

3. 3단계 로딩 모달
   ├─ "영수증 사진을 업로드하는 중..."
   ├─ "AI가 영수증을 분석하고 있습니다..."
   └─ "카테고리 및 유통기한을 계산 중..."

예상 시간: 2-3시간
```

### **Phase 2: 모듈화 완성 (우선순위: 중간)**
```
1. 핵심 컴포넌트 분리
   ├─ BarcodeScanner.tsx (바코드 로직)
   ├─ ReceiptCamera.tsx (영수증 OCR)
   └─ BarcodeModal.tsx (결과 표시)

2. scan.tsx 메인 리팩토링
   ├─ 800줄 → 200줄로 축소
   └─ 컴포넌트 조합으로 재구성

예상 시간: 3-4시간
```

### **Phase 3: UX 개선 (우선순위: 낮음)**
```
1. 신뢰도 기반 하이라이트
   ├─ confidence < 0.7 항목 표시
   └─ "확인 필요" 배지 추가

2. 대량 편집 기능
   ├─ 복수 선택 후 일괄 변경
   └─ 수량 추론("1+1", "x2") 처리

3. 이미지 처리 개선
   ├─ 리사이즈 (1600~2048px 제한)
   └─ HEIC→JPEG 변환

예상 시간: 2-3시간
```

---

## 📊 추천 진행 방식

### 🎯 **즉시 시작할 것: Phase 1 (영수증 OCR)**

**이유:**
- 백엔드 API 준비 완료되어 있음
- 실제 데이터로 테스트 가능
- 사용자 경험에 가장 큰 영향

**시작 방법:**
1. `handleUsePhoto()`에서 더미 데이터 제거
2. 실제 `/upload_receipt` API 호출
3. receipt-review.tsx 생성 및 연동

---

## 🔍 기술 상황

### 🟢 **준비된 요소**
- 백엔드: `/upload_receipt` 완료
- ML 모델: `item_classifier.pkl` 준비
- 데이터베이스: 스키마 및 캐싱 구조 완료
- UI 기반: 모드 전환, 사진 촬영 완료

### 🟡 **진행 중인 요소**
- 프론트엔드: 모듈화 진행 중 (부분 완료)
- 영수증 OCR: UI 연동 필요

### 🔵 **부족한 요소**
- MLOps 피드백 수집
- 오프라인 모드 지원
- 성능 최적화

---

## 📈 성공 척도

### **기능적 성공**
- [ ] 영수증 사진 → 5개 이상 품목 인식
- [ ] 카테고리 정확도 80% 이상
- [ ] 3단계 로딩 10초 내 완료

### **기술적 성공**
- [ ] scan.tsx 500줄 이하로 감소
- [ ] 컴포넌트 재사용율 60% 이상
- [ ] 테스트 커버리지 80% 이상

---

## 🎬 최종 목표

**2주 내 완료 목표**: 사용자가 실제로 영수증을 스캔하고, 카테고리를 수정하고, 재고에 추가하는 전체 흐름을 안정적으로 구현

**1개월 내 완료 목표**: MLOps 피드백 수집을 통한 점진적 AI 개선 사이클 구축

---

## 🔄 변경 로그

**2025-11-15**
- ✅ 모듈화 시작 (components/scan/)
- ✅ 바코드 캐싱 시스템 완성
- ✅ /upload_receipt API 추가
- 📋 Phase 1-3 계획 수립

---

## 이전 해결된 문제들 (참고)

### 1. 실시간 재고 업데이트 문제 해결
- [x] **문제 진단:** 재고 목록 화면이 실시간으로 업데이트되지 않는 문제 발생.
- [x] **원인 파악:** Supabase 무료 플랜의 정책 변경으로 실시간 구독(Realtime) 기능 사용 불가.
- [x] **해결:**
    - [x] `index.tsx`: `useFocusEffect`를 적용하여, 화면이 보일 때마다 데이터를 새로고침하도록 수정.
    - [x] `index.tsx`: 헤더에 '새로고침' 버튼을 추가하여 수동 업데이트 기능 제공.
    - [x] `scan.tsx`: 상품 추가 성공 시, 재고 목록 탭으로 자동 이동하여 즉시 결과를 확인하도록 개선.

### 2. 백엔드 연동 및 데이터베이스 문제 해결
- [x] **문제 진단:** 바코드 스캔 시 서버와 통신 실패 및 데이터베이스 저장 오류 발생.
- [x] **원인 파악:**
    - [x] 프론트엔트-백엔드 간 IP 주소 불일치.
    - [x] PC 방화벽으로 인한 포트(`5000`, `8081`) 연결 차단.
    - [x] API 응답 필드(`product_name`)와 프론트엔드 기대 필드(`name`) 불일치.
    - [x] `categories` 테이블 데이터 누락 및 ID 시퀀스 문제로 인한 외래 키 제약조건 위반.
- [x] **해결:**
    - [x] `scan.tsx`의 `BACKEND_URL`을 실제 서버 IP로 수정.
    - [x] Windows 방화벽에 포트 `5000`번과 `8081`번에 대한 인바운드 규칙 추가.
    - [x] `scan.tsx`에서 `product_name`을 `name`으로 매핑하도록 로직 수정.
    - [x] `TRUNCATE TABLE ... RESTART IDENTITY` 명령으로 `categories` 테이블 및 ID 시퀀스를 초기화하고, `categories_master.csv` 데이터 재임포트.

### 3. 로컬 빌드 및 실행 (Android Studio)
- [x] **빌드 방식 전환:** `eas build`의 횟수 제한 및 용량 문제로 인해, **Android Studio를 사용한 로컬 빌드** 방식으로 전환.
- [x] **문제 해결:** 로컬 빌드 과정에서 발생한 아래 문제들을 순차적으로 해결.
    - [x] **`Not authorized for developing` 오류:** 안드로이드 기기에서 'USB 디버깅 허용' 팝업을 승인하여 해결.
    - [x] **`INSTALL_FAILED_VERSION_DOWNGRADE` 오류:** 기기에 설치된 기존의 높은 버전 앱을 수동으로 삭제하여 해결.
    - [x] **`SocketTimeoutException` 오류:** PC 방화벽 규칙을 추가하여 기기와 Metro 서버 간의 통신 문제 해결.
- [x] **최종 성공:** Android Studio를 통해 앱을 성공적으로 빌드하고 기기에서 실행 완료.

### 4. 최종 기능 동작 확인
- [x] **기능 검증 완료:** Android Studio를 통해 로컬 빌드된 앱에서 아래의 핵심 기능들이 모두 정상적으로 동작하는 것을 최종 확인.
    - [x] 바코드 스캔 및 백엔드 API를 통한 상품 정보 조회.
    - [x] 유통기한 입력 및 재고 추가 (Supabase DB 저장).
    - [x] 재고 목록 화면 자동 새로고침 및 수동 새로고침.
