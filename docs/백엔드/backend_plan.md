# 백엔드 개발 플랜

## 📋 개요

이 문서는 AI 식료품 관리 앱의 백엔드 개발을 위한 상세 계획입니다.

---

## ✅ 완료된 기능

### 1. API 레이어 업그레이드 및 기능 개선 [✅ 2025-11-13 DB 캐싱 + 실시간 재고 구현 완료]

#### 1.1 바코드 조회 API 완성
- **외부 API 연동**: Open Food Facts, FOOD_QR, 식품안전나라
- **3단계 조회**: 무제한 API → 제한된 API 순서
- **DB 캐싱**: products 테이블에 조회 결과 저장
- **카테고리 매핑**: categories 테이블 JOIN

#### 1.2 영수증 OCR API 기본 구조
- **PaddleOCR**: 한국어 모델 설치 및 초기화 완료
- **업로드 엔드포인트**: `/upload_receipt_image` 기본 구조
- **DB 연동**: receipts, receipt_items 테이블 저장 로직

---

## 🚧 진행 중인 기능

### 1. 영수증 OCR 기능 구현 [🚧 2025-11-13 진행중]

#### 1.1 AI 텍스트 분류 모델 완성 [🚧 우선순위 1]
- [ ] **훈련 스크립트 실행**: `python train_model.py`
- [ ] **모델 파일 확인**: 
  - [ ] `models/item_classifier.pkl` (훈련된 모델)
  - [ ] `models/vectorizer.pkl` (TF-IDF 변환기)
  - [ ] `models/categories_map.pkl` (카테고리 맵)
- [ ] **정확도 테스트**: 80% 이상 목표
- [ ] **백엔드 연동**: `predict_item_category_and_expiry` 함수 개선

#### 1.2 PaddleOCR 이미지 처리 개선 [🚧 우선순위 2]
- [ ] **이미지 압축**: 프론트엔드에서 2048x2048 리사이징
- [ ] **Storage 연동**: 이미지를 Supabase Storage 'ocr' 버킷에 저장
- [ ] **오류 처리**: OCR 실패 시 graceful handling
- [ ] **결과 필터링**: 숫자, 금액, 가게명 제외

#### 1.3 프론트엔드-백엔드 연동 [🚧 우선순위 3]
- [ ] **이미지 업로드**: FormData 형식으로 이미지 전송
- [ ] **인증 처리**: JWT 토큰 기반 사용자 인증
- [ ] **결과 응답**: 표준화된 JSON 형식으로 반환
- [ ] **성능 최적화**: 처리 시간 15초 내외 목표

---

## 🎯 다음 개발 계획

### 2. MLOps 파이프라인 구축 [📋 예정]

#### 2.1 사용자 피드백 수집
- [ ] **피드백 테이블**: `user_category_feedback` 생성
- [ ] **수집 UI**: 카테고리 수정 시 피드백 기록
- [ ] **데이터 구조**: 원본 예측 vs 사용자 수정
- [ ] **일일 수집**: 10건 이상 피드백 목표

#### 2.2 MLflow 연동
- [ ] **실험 추적**: 모델 훈련 및 성능 메트릭
- [ ] **모델 레지스트리**: 버전 관리 및 자동 배포
- [ ] **성능 대시보드**: 실시간 모델 정확도 모니터링
- [ ] **자동 재학습**: 피드백 기반 주간 재학습

#### 2.3 Label Studio 연동
- [ ] **데이터 어노테이션**: 저품질 품목 수동 라벨링
- [ ] **데이터셋 확장**: 새로운 품목 추가 및 학습
- [ ] **품질 관리**: 어노테이션 데이터 품질 검증

---

## 🏗️ 아키텍처 개선 계획

### 현재 아키텍처
```
[📱 프론트엔드] ← (REST API) → [⚙️ 백엔드: Flask] ← (SDK) → [☁️ DB: Supabase]
 (React Native, Vision Camera)            (PaddleOCR, AI 모델, 바코드 API)          (PostgreSQL + Realtime)
```

### 개선 목표 아키텍처
```
[📱 프론트엔드] ← (REST API) → [⚙️ 백엔드: Flask] ← (SDK) → [☁️ DB: Supabase]
                      ↕                     ↕              ↕
                 [📦 Storage: ocr]    [🤖 AI Model]    [📊 MLflow]
                 (이미지 저장)         (자동 분류)      (성능 추적)
```

---

## 📊 성능 개선 목표

### 현재 성능
- **바코드 조회**: 500ms (DB HIT) / 2-3초 (API 호출)
- **OCR 처리**: 미측정 (PaddleOCR 미성능 테스트 필요)
- **모델 정확도**: 미측정 (훈련 필요)

### 목표 성능
- **바코드 조회**: 300ms (DB HIT) / 1.5초 (API 호출)
- **OCR 처리**: 5-10초 (2048x2048 이미지)
- **모델 정확도**: 85% (초기) → 95% (MLOps 개선)

---

## 🔧 기술 스택 최종 확정

### 핵심 라이브러리
- **웹 프레임워크**: Flask 2.3.3
- **OCR 엔진**: PaddleOCR 2.7.3
- **머신러닝**: scikit-learn 1.3.0
- **데이터 처리**: pandas 2.0.3, numpy 1.24.3
- **데이터베이스**: Supabase (PostgreSQL + Realtime)

### MLOps 스택
- **모델 관리**: MLflow (추가 예정)
- **데이터 어노테이션**: Label Studio (추가 예정)
- **모델 배포**: 자동화 파이프라인 (추가 예정)
- **성능 모니터링**: Grafana + Prometheus (장기 계획)

---

## 🛠️ 개발 우선순위

### Phase 1: 핵심 기능 완성 (긴급)
1. **AI 모델 훈련** (2-3시간) - 현재 최대 병목
2. **OCR 이미지 처리** (1-2시간) - End-to-End 연동 필요
3. **Storage 연동** (1시간) - 이미지 저장 필수

### Phase 2: UX 개선 (중요)
1. **결과 화면** (2-3시간) - 사용자 경험 핵심
2. **카테고리 수정** (1-2시간) - 정확도 개선 수단
3. **일괄 재고 추가** (1시간) - 실용성 핵심

### Phase 3: 안정화 (중요)
1. **에러 처리** (1시간) - 서버 안정성
2. **성능 최적화** (2시간) - 처리 속도 개선
3. **통합 테스트** (2-3시간) - E2E 검증

---

## 📝 LLM 아키텍처 전환에 따른 업데이트 제안 (2025-11-16)

- [ ] **"영수증 OCR 기능 구현" 섹션 전면 수정:**
  - [ ] **1.1 AI 텍스트 분류 모델 완성:** 로컬 모델 훈련 계획(`train_model.py`, 정확도 80% 목표 등)이 **Gemini LLM API 연동으로 대체**되었음을 명시. 로컬 모델(.pkl)은 더 이상 사용되지 않음.
  - [ ] **1.2 PaddleOCR 이미지 처리 개선:** OCR 엔진이 Clova OCR로 최종 확정되었음을 반영.
  - [ ] **1.3 프론트엔드-백엔드 연동:** API 로직이 LLM 호출 기반의 비동기 처리로 변경되었음을 명시.
- [ ] **"MLOps 파이프라인 구축" 섹션 수정:**
  - [ ] OCR 품목 분류에 대한 MLOps 계획(사용자 피드백, MLflow, Label Studio 연동)이 **LLM 전환으로 인해 보류 또는 폐기**되었음을 명시.
- [ ] **"기술 스택 최종 확정" 섹션 업데이트:**
  - [ ] OCR 엔진: `PaddleOCR` -> `Clova OCR`
  - [ ] 머신러닝: `scikit-learn` 제거, `google-generativeai` 추가.
  - [ ] MLOps 스택: OCR 품목 분류와 관련하여 현재 계획이 변경되었음을 명시.
- [ ] **"아키텍처 개선 계획" 섹션 업데이트:**
  - [ ] 개선 목표 아키텍처의 `[🤖 AI Model]`이 로컬 모델이 아닌 **외부 LLM API**임을 명확히 하는 다이어그램 수정.
